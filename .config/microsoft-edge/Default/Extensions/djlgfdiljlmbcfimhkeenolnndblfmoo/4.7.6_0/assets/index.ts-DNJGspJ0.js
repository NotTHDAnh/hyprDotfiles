import{m as I,k as S,T as O,M as he,w as ge,c as Be}from"./_commonjsHelpers-DBcs7C3A.js";import{b as je,A as Ue,I as Ne,h as Re,g as Fe,C as qe,y as Ye,m as He,u as Ve,p as ye,d as pe,P as be}from"./index-4Xml3FNN.js";import{p as F,h as q,e as Ke}from"./const-D_HoJBVL.js";function We(n){const{hostMatch:t,extensionId:e,extensionName:r}=n;chrome.tabs.onUpdated.addListener(async(i,u,s)=>{if(s&&s.url&&s&&s.url&&u&&u.status==="loading"){const h=new URL(s.url).hostname;if(t.find(d=>!!~d.indexOf(h))){const d=chrome.runtime.getManifest();chrome.scripting.executeScript({injectImmediately:!0,world:"MAIN",target:{tabId:i,allFrames:!0},func:b=>{window[b.slug]=b},args:[{id:chrome.runtime.id,slug:e,extensionName:r,version:d.version,icons:d.icons,extensionFolderUri:chrome.runtime.getURL("/"),isProdMode:"update_url"in chrome.runtime.getManifest()}]})}}})}var xe=(n=>(n[n.FREE=0]="FREE",n[n.BASIC=1]="BASIC",n[n.PREMIUM=2]="PREMIUM",n))(xe||{});const Je={type:"object",properties:{uid:{type:"string",default:""},email:{type:"string",default:""},stripeId:{type:"string",default:""},name:{type:"string",default:""},payments:{type:"array",items:{type:"object",properties:{},required:[],default:{}},default:[]},plan:{type:"string",default:xe.FREE},isSubscriptionActive:{type:"boolean",default:!1},lastCheckAt:{type:"number",default:0}},required:["uid","email","stripeId","name","payments","plan","isSubscriptionActive","lastCheckAt"],default:{}},Ge={type:"object",properties:{},required:[],default:{}},ze={type:"object",properties:{},required:[],default:{}},ne={customerDataV2:Je,features:Ge,persistLocalStorage:ze};function we(n,t){Object.keys(n).map(e=>t(n[e],e,n))}function te(n,t){function e(u,s){switch(u.type){case"object":return r(u,s);case"array":return i(u,s);default:return s!==void 0?s:u.default!==void 0?u.default:void 0}}function r(u,s){const h={},d=u.properties??{};return we(d,(b,T)=>{if(u.required.includes(T)||s!==void 0&&s[T]!==void 0){let f=s!==void 0?s[T]:void 0;!b.properties&&b.default&&b.type==="object"&&b.additionalProperties&&(f=b.default),h[T]=e(b,f)}}),s&&we(s,(b,T)=>{h[T]===void 0&&b!==void 0&&(h[T]=b)}),h}function i(u,s){if(s===void 0)return u.default?u.default:void 0;const h=[];for(let d=0;d<s.length;d++)h.push(e(u.items??{},s[d]));return h}return e(t,n)}const ie="__storage-local-version";function Ze(n){const t=Object.keys(n);chrome.runtime.onInstalled.addListener(r=>{(r.reason==="install"||r.reason==="update")&&e()});async function e(){let r=(await chrome.storage.local.get(ie))[ie];const i=chrome.runtime.getManifest().version;if(i!==r){const u=await chrome.storage.local.get(t),s=t.reduce((h,d)=>{let b=u[d]||{};return b=te(b,n[d]),h[d]=b,h},{[ie]:i});await chrome.storage.local.set(s)}}}function re(n,t){async function e(s){let h;return await navigator.locks.request(z(s),{mode:"shared"},async()=>{h=(await ve(s))[s]}),h===void 0&&(h=te(h,n[s])),h}async function r(s,h){await navigator.locks.request(z(s),{mode:"exclusive"},async()=>{let d=(await ve(s))[s];d===void 0&&(d=te(d,n[s]));const b=await h(d);await chrome.storage.local.set({[s]:b})})}async function i(s,h){await navigator.locks.request(z(s),{mode:"exclusive"},async()=>{let d=h||{};h||(d=te(d,n[s])),await chrome.storage.local.set({[s]:d})})}async function u(s){return await navigator.locks.request(z(s),{mode:"exclusive"},async()=>{await chrome.storage.local.remove([s])}),Promise.resolve()}return{updateBucket:r,setBucket:i,getBucket:e,deleteBucket:u}}function z(n){return`storage.local.${n}`}function ve(n){return new Promise(t=>{chrome.storage.local.get(n,e=>{t(e)})})}function _e(){return Math.floor(new Date().getTime()/1e3)}function $e(n){return n+86400<_e()}async function Xe(n){const t=await chrome.tabs.query({url:n.filter(e=>!~e.indexOf("esuit"))});for(let e of t)e.id&&await chrome.tabs.reload(e.id)}let Z=[];const{updateBucket:Me,getBucket:oe,deleteBucket:Se}=re(ne);function Qe(n){I("logout",async()=>{await Se("customerDataV2"),await Se("features")}),I("login",async()=>{const t=new URLSearchParams({[he.RETURN_EXT_LOCAL]:chrome.runtime.id}).toString();await chrome.tabs.create({url:`https://esuit.dev/login?${t}`,active:!0})}),I("closePopup",async()=>{chrome.extension.getViews({type:"popup"}).forEach(t=>{t.window.close()})}),I("openOptionsPage",async t=>{const e=chrome.runtime.getURL("src/pages/options/index.html"+(t?"#showSubscription=1":""));(await chrome.tabs.query({url:[e]})).forEach(r=>(r==null?void 0:r.id)&&chrome.tabs.remove(r.id)),await new Promise(r=>setTimeout(r,300)),await chrome.tabs.create({url:e,active:!0})}),I("getCustomerData",async()=>{const t=await oe("customerDataV2");if(t.uid)return $e(t.lastCheckAt)&&S("reFetchCustomerData"),t}),I("reFetchCustomerData",async(t=!1)=>{const e=await oe("customerDataV2"),r=e.uid;if(!r)return!1;if(!t&&r&&!$e(e.lastCheckAt))return!0;let i=null,u=null;try{const[d,b]=await Promise.all([fetch(`https://getusersubscription-57pphaecyq-uc.a.run.app/?token=${je(r,n.projectId)}`).then(T=>T.json()),et()]);if(d.stripeId&&(i=d),b){const T=b.find(f=>f.projectId===n.projectId);T&&(u=T)}}catch(d){return console.error(d),"Unknown error, please contact the developer."}if(!i||!u)return"ERROR: reFetchCustomerData returned undefined";let s=i.allPayments.filter(d=>Ue(d.status)||Ne(d.status)||Re(d.status)||Fe(d.status)||qe(d.status)),h=O.FREE;return De(s,u,O.BASIC)&&(h=O.BASIC),De(s,u,O.PREMIUM)&&(h=O.PREMIUM),await Me("customerDataV2",async d=>i?{uid:r,stripeId:i.stripeId,email:i.email,name:i.name,payments:i.allPayments,plan:h,isSubscriptionActive:h!==O.FREE,lastCheckAt:_e()}:d),S("rejectFeaturesToWindow"),!0}),I("visitPricingPage",async()=>{const t=`https://esuit.dev/pricing/${n.projectId}`,e=new URLSearchParams({[he.RETURN_EXT_LOCAL]:chrome.runtime.id}).toString();await chrome.tabs.create({url:t+`?${e}`,active:!0})}),I("visitDashboard",async()=>{await chrome.tabs.create({url:"https://esuit.dev/dashboard",active:!0}),S("closePopup")}),ge("ifUserLogin",async()=>!!(await oe("customerDataV2")).uid),ge("userInfoUpdate",async([t])=>{t&&(await Me("customerDataV2",e=>(e.uid=t,e)),await S("reFetchCustomerData",!0),S("openOptionsPage",!0),setTimeout(()=>{Xe(n.hostMatch)},2e3))})}async function et(){if(Z.length>0)return Z;const n=await fetch("https://static-data.esuit.dev/index.json").then(t=>t.json());return Z=Ye(n),Z}function De(n,t,e){return!!n.find(r=>{if(![...He,...Ve,...ye,...pe,...be].includes(r.status)||[...ye].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3))||[...pe].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3))||[...be].includes(r.status)&&(!r.nextBillingDate||r.nextBillingDate<Math.ceil(new Date().getTime()/1e3)))return!1;const i=t.prices.find(u=>u.id===r.priceId);return!(!i||i.plan!==e)})}var tt=Object.defineProperty,nt=(n,t,e)=>t in n?tt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,X=(n,t,e)=>(nt(n,typeof t!="symbol"?t+"":t,e),e);class de{constructor(t,e){X(this,"listeners",{}),X(this,"tabs",[]),X(this,"slug"),X(this,"isDebugger"),this.slug=t,this.isDebugger=!!e,this.bindMessage(),this.bindEvent()}on(t,e){if(this.listeners[t])throw new Error(`event listener ${String(t)} already exist!`);return this.listeners[t]=e,()=>{delete this.listeners[t]}}async send(t,...e){this.isDebugger&&console.log("send message from background script",{action:t,payload:e,tabs:this.tabs});for(let r of this.tabs)try{const i=await chrome.tabs.get(r);i&&i.id?chrome.tabs.sendMessage(i.id,{from:this.slug,payload:{action:t,payload:e}}):this.deleteTabById(r)}catch(i){console.log(i),this.deleteTabById(r)}}bindMessage(){chrome.runtime.onMessageExternal.addListener((t,e,r)=>{var i,u;if((i=e==null?void 0:e.tab)!=null&&i.id){if(this.isDebugger&&console.log("received message from page",{request:t,sender:e}),t.action==="__connect")return this.tabs.includes(e.tab.id)||this.tabs.push(e.tab.id),r();if(t.action==="__disconnect")return this.deleteTabById(e.tab.id),r();if(this.listeners[t.action])return(u=e==null?void 0:e.tab)!=null&&u.id?(this.tabs.includes(e.tab.id)||this.tabs.push(e.tab.id),this.listeners[t.action](...t.payload).then(s=>{this.isDebugger&&console.log("send to callback from background",{request:t,sender:e,res:s}),r(s)}),!0):r();console.log(`unknown event ${t.action}`)}})}bindEvent(){chrome.tabs.onRemoved.addListener(t=>{this.deleteTabById(t)})}deleteTabById(t){if(this.tabs.includes(t)){const e=this.tabs.indexOf(t);this.tabs.splice(e,1)}}}function rt(n){return[O.FREE,O.BASIC,O.PREMIUM].indexOf(n)}function st(n,t){const e=rt(t);return n.limitation?n.limitation[e]:0}function Ie(n,t){return{[O.FREE]:1,[O.BASIC]:10,[O.PREMIUM]:100}[t]>=n.permission}function ce(n,t){return n.map(e=>{t[e.key]?(t[e.key].enable=t[e.key].enable??e.defaultEnable,t[e.key].currentFreeTryCount=t[e.key].currentFreeTryCount??0):t[e.key]={enable:e.defaultEnable,currentFreeTryCount:0}}),t}function at(n){const{cacheId:t,defaultMemoConfig:e}=n;I("setUIMemoSettings",async r=>{await chrome.storage.local.set({[t]:r})}),I("getUIMemoSettings",async()=>{const r=await S("getFeaturesDataByPlan");let i=await new Promise(u=>{chrome.storage.local.get([t]).then(s=>{s[t]?u(s[t]):u(!1)})});return i||(i={...e}),Object.keys(i).map(u=>{const s=Object.values(r).find(d=>d._.memoKey===u);if(s&&s.needUpgrade&&(!s.enable||!(s.freeTryLeft>0||s.limitation>0)&&e[u]!==void 0))return h();function h(){i[u]=e[u]}}),{...e,...i}})}let Oe=!1;function it(){return Oe}function ot(){Oe=!0}const{updateBucket:ue,getBucket:Te}=re(ne);function ct(n){if(it())return;ot();const t=new de(n,!0);return I("getAllPersistLocalStorage",()=>Te("persistLocalStorage")),I("setPersistLocalStorage",async(e,r)=>{await ue("persistLocalStorage",i=>{try{r=JSON.stringify(r)}catch{}return i[e]=r,i})}),I("getPersistLocalStorage",async(e,r)=>{const i=await Te("persistLocalStorage");if(i[e]){try{return JSON.parse(i[e])}catch{}return i[e]}return r??void 0}),I("clearPersistLocalStorage",async()=>{ue("persistLocalStorage",()=>({}))}),I("removePersistLocalStorage",async e=>{ue("persistLocalStorage",r=>(delete r[e],r))}),t.on("getAllPersistLocalStorage",()=>S("getAllPersistLocalStorage")),t.on("setPersistLocalStorage",(...e)=>S("setPersistLocalStorage",...e)),t.on("getPersistLocalStorage",(...e)=>S("getPersistLocalStorage",...e)),t.on("clearPersistLocalStorage",()=>S("clearPersistLocalStorage")),void t.on("removePersistLocalStorage",e=>S("removePersistLocalStorage",e))}const{setBucket:ke,getBucket:le}=re(ne);function ut(n){const{projectId:t,hostMatch:e,cacheId:r,features:i,defaultMemoConfig:u}=n,s=new de(t,!0);return ct(n.projectId),at({cacheId:r,defaultMemoConfig:u}),chrome.tabs.onUpdated.addListener(async(f,M,g)=>{if(g&&g.url&&M.status==="loading"){const $=new URL(g.url).hostname;e.find(E=>!!~E.indexOf($))&&d(f)}}),chrome.storage.onChanged.addListener((f,M)=>{M==="local"&&f&&f.features&&h()}),I("rejectFeaturesToWindow",async()=>{h()}),I("getFeature",async f=>b()[f]),I("consumeFeaturesTreeTryByMemoUIConfigs",async f=>{const M=await b();let g=[];Object.entries(f).map(([$,E])=>{if(u[$]!==void 0&&u[$]!==E){const P=Object.values(M).find(A=>A._.memoKey===$);P&&P.isCanFreeTry&&g.push(P._.key)}}),g.length>0&&S("consumeFeatureTreeTry",g)}),I("consumeFeatureTreeTry",async f=>{let M=ce(i,await le("features"));const g=await T();let $=!1;f.map(E=>{const P=i.find(A=>A.key===E||A.memoKey===E);P&&(Ie(P,g)||(M[P.key].currentFreeTryCount++,$=!0))}),$&&await ke("features",M)}),I("saveFeaturesEnables",async f=>{let M=ce(i,await le("features"));Object.entries(f).map(([g,$])=>{M[g].enable=$}),await ke("features",M)}),I("getFeaturesDataByPlan",b),s.on("getUIMemoSettings",()=>S("getUIMemoSettings")),s.on("setUIMemoSettings",f=>S("setUIMemoSettings",f)),s.on("consumeFeatureTreeTry",f=>S("consumeFeatureTreeTry",f)),s.on("visitPricingPage",()=>S("visitPricingPage")),void s.on("consumeFeaturesTreeTryByMemoUIConfigs",f=>{S("consumeFeaturesTreeTryByMemoUIConfigs",f)});async function h(){const f=await chrome.tabs.query({url:e});f&&f.map(M=>{M&&M.id&&d(M.id)})}async function d(f){const M=await b();chrome.scripting.executeScript({injectImmediately:!0,world:"MAIN",target:{tabId:f,allFrames:!0},func:(g,$)=>{window[$]=JSON.parse(g)},args:[JSON.stringify(M),`${t.replaceAll("-","_")}`]})}async function b(){const f=await T();let M=ce(i,await le("features"));return i.map(g=>{var $;const E=Ie(g,f);let P,A=0;return g.memoKey&&(P=u[g.memoKey]),g.maxFreeTryCount&&M[g.key].currentFreeTryCount!==void 0&&(A=Math.max(0,g.maxFreeTryCount-M[g.key].currentFreeTryCount)),{enable:(($=M[g.key])==null?void 0:$.enable)??g.defaultEnable,needUpgrade:!E,limitation:st(g,f),permission:g.permission,freeTryLeft:g.maxFreeTryCount?A:0,isCanFreeTry:!!g.maxFreeTryCount&&g.maxFreeTryCount>0,defaultValue:P,_:g}}).reduce((g,$)=>(g[$._.key]=$,g),{})}async function T(){const f=await S("getCustomerData");return f?f.plan:O.FREE}}function lt(n,t){(async()=>{let e=0,r=(await chrome.declarativeNetRequest.getDynamicRules()).map(u=>u.id);const i=n.map((u,s)=>(e=s+1,{id:e,priority:1,action:{type:"modifyHeaders",responseHeaders:[{header:"Content-Security-Policy",operation:"remove"},{header:"Content-Security-Policy-Report-Only",operation:"remove"}]},condition:{regexFilter:u,resourceTypes:["main_frame","xmlhttprequest"]}}));await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:r,addRules:i})})()}function dt(n){const t=new de(n,!0);t.on("reFetchCustomerData",e=>S("reFetchCustomerData",e)),t.on("visitDashboard",()=>S("visitDashboard")),t.on("getCustomerData",()=>S("getCustomerData")),t.on("logout",()=>S("logout")),t.on("login",()=>S("login"))}function ft(n){Ze(ne),Qe(n),dt(n.projectId)}var mt={exports:{}};(function(n,t){(function(e,r){n.exports=r()})(Be,function(){var e=1e3,r=6e4,i=36e5,u="millisecond",s="second",h="minute",d="hour",b="day",T="week",f="month",M="quarter",g="year",$="date",E="Invalid Date",P=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,A=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,Ee={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(m){var c=["th","st","nd","rd"],a=m%100;return"["+m+(c[(a-20)%10]||c[a]||c[0])+"]"}},se=function(m,c,a){var l=String(m);return!l||l.length>=c?m:""+Array(c+1-l.length).join(a)+m},Ae={s:se,z:function(m){var c=-m.utcOffset(),a=Math.abs(c),l=Math.floor(a/60),o=a%60;return(c<=0?"+":"-")+se(l,2,"0")+":"+se(o,2,"0")},m:function m(c,a){if(c.date()<a.date())return-m(a,c);var l=12*(a.year()-c.year())+(a.month()-c.month()),o=c.clone().add(l,f),y=a-o<0,p=c.clone().add(l+(y?-1:1),f);return+(-(l+(a-o)/(y?o-p:p-o))||0)},a:function(m){return m<0?Math.ceil(m)||0:Math.floor(m)},p:function(m){return{M:f,y:g,w:T,d:b,D:$,h:d,m:h,s,ms:u,Q:M}[m]||String(m||"").toLowerCase().replace(/s$/,"")},u:function(m){return m===void 0}},Y="en",j={};j[Y]=Ee;var fe="$isDayjsObject",ae=function(m){return m instanceof J||!(!m||!m[fe])},W=function m(c,a,l){var o;if(!c)return Y;if(typeof c=="string"){var y=c.toLowerCase();j[y]&&(o=y),a&&(j[y]=a,o=y);var p=c.split("-");if(!o&&p.length>1)return m(p[0])}else{var v=c.name;j[v]=c,o=v}return!l&&o&&(Y=o),o||!l&&Y},k=function(m,c){if(ae(m))return m.clone();var a=typeof c=="object"?c:{};return a.date=m,a.args=arguments,new J(a)},w=Ae;w.l=W,w.i=ae,w.w=function(m,c){return k(m,{locale:c.$L,utc:c.$u,x:c.$x,$offset:c.$offset})};var J=function(){function m(a){this.$L=W(a.locale,null,!0),this.parse(a),this.$x=this.$x||a.x||{},this[fe]=!0}var c=m.prototype;return c.parse=function(a){this.$d=function(l){var o=l.date,y=l.utc;if(o===null)return new Date(NaN);if(w.u(o))return new Date;if(o instanceof Date)return new Date(o);if(typeof o=="string"&&!/Z$/i.test(o)){var p=o.match(P);if(p){var v=p[2]-1||0,D=(p[7]||"0").substring(0,3);return y?new Date(Date.UTC(p[1],v,p[3]||1,p[4]||0,p[5]||0,p[6]||0,D)):new Date(p[1],v,p[3]||1,p[4]||0,p[5]||0,p[6]||0,D)}}return new Date(o)}(a),this.init()},c.init=function(){var a=this.$d;this.$y=a.getFullYear(),this.$M=a.getMonth(),this.$D=a.getDate(),this.$W=a.getDay(),this.$H=a.getHours(),this.$m=a.getMinutes(),this.$s=a.getSeconds(),this.$ms=a.getMilliseconds()},c.$utils=function(){return w},c.isValid=function(){return this.$d.toString()!==E},c.isSame=function(a,l){var o=k(a);return this.startOf(l)<=o&&o<=this.endOf(l)},c.isAfter=function(a,l){return k(a)<this.startOf(l)},c.isBefore=function(a,l){return this.endOf(l)<k(a)},c.$g=function(a,l,o){return w.u(a)?this[l]:this.set(o,a)},c.unix=function(){return Math.floor(this.valueOf()/1e3)},c.valueOf=function(){return this.$d.getTime()},c.startOf=function(a,l){var o=this,y=!!w.u(l)||l,p=w.p(a),v=function(N,_){var B=w.w(o.$u?Date.UTC(o.$y,_,N):new Date(o.$y,_,N),o);return y?B:B.endOf(b)},D=function(N,_){return w.w(o.toDate()[N].apply(o.toDate("s"),(y?[0,0,0,0]:[23,59,59,999]).slice(_)),o)},C=this.$W,x=this.$M,L=this.$D,R="set"+(this.$u?"UTC":"");switch(p){case g:return y?v(1,0):v(31,11);case f:return y?v(1,x):v(0,x+1);case T:var U=this.$locale().weekStart||0,H=(C<U?C+7:C)-U;return v(y?L-H:L+(6-H),x);case b:case $:return D(R+"Hours",0);case d:return D(R+"Minutes",1);case h:return D(R+"Seconds",2);case s:return D(R+"Milliseconds",3);default:return this.clone()}},c.endOf=function(a){return this.startOf(a,!1)},c.$set=function(a,l){var o,y=w.p(a),p="set"+(this.$u?"UTC":""),v=(o={},o[b]=p+"Date",o[$]=p+"Date",o[f]=p+"Month",o[g]=p+"FullYear",o[d]=p+"Hours",o[h]=p+"Minutes",o[s]=p+"Seconds",o[u]=p+"Milliseconds",o)[y],D=y===b?this.$D+(l-this.$W):l;if(y===f||y===g){var C=this.clone().set($,1);C.$d[v](D),C.init(),this.$d=C.set($,Math.min(this.$D,C.daysInMonth())).$d}else v&&this.$d[v](D);return this.init(),this},c.set=function(a,l){return this.clone().$set(a,l)},c.get=function(a){return this[w.p(a)]()},c.add=function(a,l){var o,y=this;a=Number(a);var p=w.p(l),v=function(x){var L=k(y);return w.w(L.date(L.date()+Math.round(x*a)),y)};if(p===f)return this.set(f,this.$M+a);if(p===g)return this.set(g,this.$y+a);if(p===b)return v(1);if(p===T)return v(7);var D=(o={},o[h]=r,o[d]=i,o[s]=e,o)[p]||1,C=this.$d.getTime()+a*D;return w.w(C,this)},c.subtract=function(a,l){return this.add(-1*a,l)},c.format=function(a){var l=this,o=this.$locale();if(!this.isValid())return o.invalidDate||E;var y=a||"YYYY-MM-DDTHH:mm:ssZ",p=w.z(this),v=this.$H,D=this.$m,C=this.$M,x=o.weekdays,L=o.months,R=o.meridiem,U=function(_,B,V,G){return _&&(_[B]||_(l,y))||V[B].slice(0,G)},H=function(_){return w.s(v%12||12,_,"0")},N=R||function(_,B,V){var G=_<12?"AM":"PM";return V?G.toLowerCase():G};return y.replace(A,function(_,B){return B||function(V){switch(V){case"YY":return String(l.$y).slice(-2);case"YYYY":return w.s(l.$y,4,"0");case"M":return C+1;case"MM":return w.s(C+1,2,"0");case"MMM":return U(o.monthsShort,C,L,3);case"MMMM":return U(L,C);case"D":return l.$D;case"DD":return w.s(l.$D,2,"0");case"d":return String(l.$W);case"dd":return U(o.weekdaysMin,l.$W,x,2);case"ddd":return U(o.weekdaysShort,l.$W,x,3);case"dddd":return x[l.$W];case"H":return String(v);case"HH":return w.s(v,2,"0");case"h":return H(1);case"hh":return H(2);case"a":return N(v,D,!0);case"A":return N(v,D,!1);case"m":return String(D);case"mm":return w.s(D,2,"0");case"s":return String(l.$s);case"ss":return w.s(l.$s,2,"0");case"SSS":return w.s(l.$ms,3,"0");case"Z":return p}return null}(_)||p.replace(":","")})},c.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},c.diff=function(a,l,o){var y,p=this,v=w.p(l),D=k(a),C=(D.utcOffset()-this.utcOffset())*r,x=this-D,L=function(){return w.m(p,D)};switch(v){case g:y=L()/12;break;case f:y=L();break;case M:y=L()/3;break;case T:y=(x-C)/6048e5;break;case b:y=(x-C)/864e5;break;case d:y=x/i;break;case h:y=x/r;break;case s:y=x/e;break;default:y=x}return o?y:w.a(y)},c.daysInMonth=function(){return this.endOf(f).$D},c.$locale=function(){return j[this.$L]},c.locale=function(a,l){if(!a)return this.$L;var o=this.clone(),y=W(a,l,!0);return y&&(o.$L=y),o},c.clone=function(){return w.w(this.$d,this)},c.toDate=function(){return new Date(this.valueOf())},c.toJSON=function(){return this.isValid()?this.toISOString():null},c.toISOString=function(){return this.$d.toISOString()},c.toString=function(){return this.$d.toUTCString()},m}(),me=J.prototype;return k.prototype=me,[["$ms",u],["$s",s],["$m",h],["$H",d],["$W",b],["$M",f],["$y",g],["$D",$]].forEach(function(m){me[m[1]]=function(c){return this.$g(c,m[0],m[1])}}),k.extend=function(m,c){return m.$i||(m(c,J,k),m.$i=!0),k},k.locale=W,k.isDayjs=ae,k.unix=function(m){return k(1e3*m)},k.en=j[Y],k.Ls=j,k.p={},k})})(mt);var K=(n=>(n.INDEX="index",n.DATE="date",n.TIME="time",n.TIMESTAMP="timestamp",n.FILE_ID="file id",n.USER_ID="user id",n.USERNAME="username",n.ORIGINAL_NAME="original name",n._0Index="0index",n._00Index="00index",n._000Index="000index",n.DATE_US="date us",n.YEARS="years",n.MONTHs="months",n.DAYs="days",n.HOURS="hours",n.MINUTES="minutes",n.SECONDS="seconds",n))(K||{});const ht=["-**original name**-","-**index**-_-**date**-","-**date**-","-**timestamp**-","-**username**-_-**date**-","-**file id**-_-**date**-","-**username**-_-**timestamp**-"],gt=[`-**${K.USERNAME}**-`,`-**${K.YEARS}**---**${K.MONTHs}**---**${K.DAYs}**-`];var Pe=(n=>(n.ORIGINAL="none",n.PNG="image/png",n.JPG="image/jpeg",n.WEBP="image/webp",n))(Pe||{}),Le=(n=>(n[n.ALL=0]="ALL",n[n.BY_PHOTOS_COUNT=1]="BY_PHOTOS_COUNT",n[n.BY_DAYS_COUNT=2]="BY_DAYS_COUNT",n))(Le||{});const yt=[{key:"fetchLimit",name:"Fetch Count limit",permission:1,limitation:[300,0,0],defaultEnable:!0,memoKey:null},{key:"carouselDownloader",name:"Carousel Download",permission:10,defaultEnable:!0,maxFreeTryCount:5,memoKey:null},{key:"imagesFormatAs",name:"Images Format feature",permission:100,defaultEnable:!0,limitation:[50,200,0],memoKey:"fileFormatAs"},{key:"fileNameFormats",name:"Filename Formats Feature",permission:100,defaultEnable:!0,limitation:[50,200,0],memoKey:"fileNameFormatRule"},{key:"folderNameRule",name:"folder name rules feature",permission:100,defaultEnable:!0,limitation:[50,200,0],memoKey:"folderNameRule"},{key:"resumeDownloading",name:"Resume Download",permission:100,defaultEnable:!0,memoKey:""},{key:"skipDownloadedFiles",name:"skip downloaded file",permission:10,defaultEnable:!0,maxFreeTryCount:5,memoKey:"isSkipDownloadedFile"}],pt={isSkipDownloadedFile:!1,isFullSpeed:!1,isGenFolder:!1,fileFormatAs:Pe.ORIGINAL,fileNameFormatRule:ht[0],requestDelay:0,folderNameRule:gt[0],fetchingCountType:Le.ALL,fetchingCountByPhotosCountValue:10,fetchingCountByPhotosDaysValue:3};var bt=Object.defineProperty,wt=(n,t,e)=>t in n?bt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,Q=(n,t,e)=>(wt(n,typeof t!="symbol"?t+"":t,e),e);class vt{constructor(t,e){Q(this,"listeners",{}),Q(this,"tabs",[]),Q(this,"slug"),Q(this,"isDebugger"),this.slug=t,this.isDebugger=!!e,this.bindMessage(),this.bindEvent()}on(t,e){if(this.listeners[t])throw new Error(`event listener ${String(t)} already exist!`);return this.listeners[t]=e,()=>{delete this.listeners[t]}}async send(t,...e){this.isDebugger&&console.log("send message from background script",{action:t,payload:e,tabs:this.tabs});for(let r of this.tabs)try{const i=await chrome.tabs.get(r);i&&i.id?chrome.tabs.sendMessage(i.id,{from:this.slug,payload:{action:t,payload:e}}):this.deleteTabById(r)}catch(i){console.log(i),this.deleteTabById(r)}}bindMessage(){chrome.runtime.onMessageExternal.addListener((t,e,r)=>{var i,u;if((i=e==null?void 0:e.tab)!=null&&i.id){if(this.isDebugger&&console.log("received message from page",{request:t,sender:e}),t.action==="__connect")return this.tabs.includes(e.tab.id)||this.tabs.push(e.tab.id),r();if(t.action==="__disconnect")return this.deleteTabById(e.tab.id),r();if(this.listeners[t.action])return(u=e==null?void 0:e.tab)!=null&&u.id?(this.tabs.includes(e.tab.id)||this.tabs.push(e.tab.id),this.listeners[t.action](...t.payload).then(s=>{this.isDebugger&&console.log("send to callback from background",{request:t,sender:e,res:s}),r(s)}),!0):r();console.log(`unknown event ${t.action}`)}})}bindEvent(){chrome.tabs.onRemoved.addListener(t=>{this.deleteTabById(t)})}deleteTabById(t){if(this.tabs.includes(t)){const e=this.tabs.indexOf(t);this.tabs.splice(e,1)}}}function $t(){return Math.floor(new Date().getTime()/1e3)}const Mt={type:"array",items:{},default:[]},St={type:"array",items:{type:"object",properties:{collectionToken:{type:"string",default:""},lastCursor:{type:"string",default:""},lastIndex:{type:"number",default:0},lastUpdateAt:{type:"number",default:0}},required:["collectionToken","lastCursor","lastIndex","lastUpdateAt"]},default:[]},Dt={resumeCursor:St,downloadedFilesId:Mt},{updateBucket:ee,setBucket:_t,getBucket:Ce,deleteBucket:Ot}=re(Dt);function It(){const n=new vt(F,Tt());n.on("clearDownloadedFilesId",()=>{ee("downloadedFilesId",()=>[])}),n.on("getDownloadedFilesId",()=>Ce("downloadedFilesId")),n.on("appendDownloadedFilesId",t=>{ee("downloadedFilesId",e=>e.length>3e5?[]:(e.push(...t),e))}),n.on("setResumeCursor",async t=>{t.collectionToken&&await ee("resumeCursor",e=>{const r=e.findIndex(s=>s.collectionToken===t.collectionToken),i=$t(),u={...t,lastUpdateAt:i};return~r?e[r]=u:e.push(u),e})}),n.on("getResumeCursor",t=>new Promise(async e=>{const i=(await Ce("resumeCursor")).find(u=>u.collectionToken===t);e(i??null)})),n.on("removeResumeCursor",async t=>{await ee("resumeCursor",e=>{const r=e.findIndex(i=>i.collectionToken===t);return~r&&e.splice(r,1),e})}),n.on("visitPricing",async()=>{S("visitPricingPage")})}function Tt(){return!("update_url"in chrome.runtime.getManifest())}lt(q);It();We({hostMatch:q,extensionId:F,extensionName:Ke});ft({projectId:F,callbackExtId:chrome.runtime.id,hostMatch:q});ut({projectId:F,hostMatch:q,cacheId:"app-3.0.9",features:yt,defaultMemoConfig:pt});chrome.scripting.registerContentScripts([{id:`inject-${F}`,js:["injects/proxy.js"],css:["injects/style.css"],matches:q,runAt:"document_start",world:"MAIN"}]);chrome.scripting.registerContentScripts([{id:`inject-${F}-module`,js:["injects/vendors.js","injects/index.js"],matches:q,runAt:"document_end",world:"MAIN"}]);
