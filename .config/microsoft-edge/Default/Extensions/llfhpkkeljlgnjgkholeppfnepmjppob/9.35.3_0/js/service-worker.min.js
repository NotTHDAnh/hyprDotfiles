const MSG_ACTIONS={GET_ENABLED_BLOCKING_RULE_IDS:"@ZaDark:GET_ENABLED_BLOCKING_RULE_IDS",UPDATE_ENABLED_BLOCKING_RULE_IDS:"@ZaDark:UPDATE_ENABLED_BLOCKING_RULE_IDS"},RULE_IDS=["rules_block_typing","rules_block_delivered","rules_block_seen"],SETTINGS_RULE_KEYS={rules_block_typing:"enabledBlockTyping",rules_block_delivered:"enabledBlockDelivered",rules_block_seen:"enabledBlockSeen"},UNINSTALL_URL="https://docs.google.com/forms/d/e/1FAIpQLSdLonVbx-IavimDRneKuUhtMox4vDbyu35tB6uzQG8FGJFbUg/viewform?usp=pp_url&entry.454875478=Chrome",handleLoadRulesets=async()=>{const e=await chrome.storage.sync.get({enabledBlockTyping:!1,enabledBlockDelivered:!1,enabledBlockSeen:!1}),s=[],l=[];RULE_IDS.forEach(a=>{const t=SETTINGS_RULE_KEYS[a];t&&(e[t]?s.push(a):l.push(a))}),chrome.declarativeNetRequest.updateEnabledRulesets({enableRulesetIds:s,disableRulesetIds:l})};chrome.runtime.onInstalled.addListener(e=>{"install"===e.reason&&(chrome.tabs.create({url:"https://zadark.com/web/chrome"}),chrome.runtime.setUninstallURL(UNINSTALL_URL),handleLoadRulesets()),"update"===e.reason&&(chrome.runtime.setUninstallURL(UNINSTALL_URL),chrome.storage.local.remove(["threadChatBg"]),handleLoadRulesets())}),chrome.runtime.onMessage.addListener((e,s,l)=>{const{action:a,payload:t}=e;if(a===MSG_ACTIONS.GET_ENABLED_BLOCKING_RULE_IDS&&chrome.declarativeNetRequest.getEnabledRulesets().then(e=>{l(e)}),a===MSG_ACTIONS.UPDATE_ENABLED_BLOCKING_RULE_IDS){const{enableRulesetIds:e,disableRulesetIds:s}=t,l={};Array.isArray(e)&&e.forEach(e=>{const s=SETTINGS_RULE_KEYS[e];s&&(l[s]=!0)}),Array.isArray(s)&&s.forEach(e=>{const s=SETTINGS_RULE_KEYS[e];s&&(l[s]=!1)}),chrome.storage.sync.set(l),chrome.declarativeNetRequest.updateEnabledRulesets({enableRulesetIds:e,disableRulesetIds:s})}return!0});