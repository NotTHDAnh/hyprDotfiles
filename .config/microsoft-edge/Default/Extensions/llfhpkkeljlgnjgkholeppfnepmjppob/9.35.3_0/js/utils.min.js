!function(t){const e={MSG_ACTIONS:{CHANGE_THEME:"@ZaDark:CHANGE_THEME",CHANGE_FONT_SIZE:"@ZaDark:CHANGE_FONT_SIZE",CHANGE_TRANSLATE_TARGET:"@ZaDark:CHANGE_TRANSLATE_TARGET",CHANGE_HIDE_LATEST_MESSAGE:"@ZaDark:CHANGE_HIDE_LATEST_MESSAGE",CHANGE_HIDE_CONV_AVATAR:"@ZaDark:CHANGE_HIDE_CONV_AVATAR",CHANGE_HIDE_CONV_NAME:"@ZaDark:CHANGE_HIDE_CONV_NAME",CHANGE_HIDE_THREAD_CHAT_MESSAGE:"@ZaDark:CHANGE_HIDE_THREAD_CHAT_MESSAGE",GET_ENABLED_BLOCKING_RULE_IDS:"@ZaDark:GET_ENABLED_BLOCKING_RULE_IDS",UPDATE_ENABLED_BLOCKING_RULE_IDS:"@ZaDark:UPDATE_ENABLED_BLOCKING_RULE_IDS",REFRESH_ZALO_TABS:"@ZaDark:REFRESH_ZALO_TABS",CHANGE_USE_HOTKEYS:"@ZaDark:CHANGE_USE_HOTKEYS"},HOTKEYS_TOAST_MESSAGE:{fontSize:{small:"Đã áp dụng cỡ chữ 90%",medium:"Đã áp dụng cỡ chữ 100%",big:"Đã áp dụng cỡ chữ 110%","very-big":"Đã áp dụng cỡ chữ 125%"},hideLatestMessage:{true:"Đã bật Ẩn Tin nhắn gần nhất",false:"Đã tắt Ẩn Tin nhắn gần nhất"},hideThreadChatMessage:{true:"Đã bật Ẩn Tin nhắn trong cuộc trò chuyện",false:"Đã tắt Ẩn Tin nhắn trong cuộc trò chuyện"},hideConvAvatar:{true:"Đã bật Ẩn Ảnh đại diện",false:"Đã tắt Ẩn Ảnh đại diện"},hideConvName:{true:"Đã bật Ẩn Tên cuộc trò chuyện",false:"Đã tắt Ẩn Tên cuộc trò chuyện"},rules_block_typing:{true:"Đã bật Ẩn trạng thái Đang soạn tin",false:"Đã tắt Ẩn trạng thái Đang soạn tin"},rules_block_delivered:{true:"Đã bật Ẩn trạng thái Đã nhận",false:"Đã tắt Ẩn trạng thái Đã nhận"},rules_block_seen:{true:"Đã bật Ẩn trạng thái Đã xem",false:"Đã tắt Ẩn trạng thái Đã xem"},useHotkeys:{true:"Đã kích hoạt phím tắt",false:"Đã vô hiệu hoá phím tắt"}},getCurrentConvId:()=>document.body.getAttribute("data-current-conv-id"),toggleBodyClassName:(t,e)=>{e?document.body.classList.add(t):document.body.classList.remove(t)},setOSAttr:t=>{document.documentElement.setAttribute("data-zadark-os",t)},setThemeAttr:t=>{document.documentElement.setAttribute("data-zadark-theme",t)},setFontFamilyAttr:t=>{if(!t)return document.querySelector(":root").style.removeProperty("--zadark-font-family"),void document.documentElement.removeAttribute("data-zadark-use-font");document.querySelector(":root").style.setProperty("--zadark-font-family",t),document.documentElement.setAttribute("data-zadark-use-font","true")},setFontSizeAttr:t=>{document.documentElement.setAttribute("data-zadark-font-size",t)},setHideLatestMessageAttr:function(t){this.toggleBodyClassName("zadark-prv--latest-message",t)},setHideConvAvatarAttr:function(t){this.toggleBodyClassName("zadark-prv--conv-avatar",t)},setHideConvNameAttr:function(t){this.toggleBodyClassName("zadark-prv--conv-name",t)},setHideThreadChatMessageAttr:function(t){this.toggleBodyClassName("zadark-prv--thread-chat-message",t)},setUseHotkeysAttr:function(t){this.toggleBodyClassName("zadark--use-hotkeys",t)},setPageTheme:function(t){switch(t){case"light":case"dark":return void this.setThemeAttr(t);case"auto":{const t=window.matchMedia("(prefers-color-scheme: dark)").matches;return void this.setThemeAttr(t?"dark":"light")}default:this.setThemeAttr("dark")}},showToast:function(t,e={}){const n=Toastify({text:t,duration:1408,gravity:"bottom",position:"center",escapeMarkup:!1,offset:{x:15,y:15},...e,onClick:function(){n.hideToast()}});return n.showToast(),n},showIntro:({steps:t=[],onExit:e,onComplete:n}={})=>{const a=introJs().setOptions({steps:t,disableInteraction:!1,prevLabel:"Trước",nextLabel:"Tiếp",doneLabel:"Đã hiểu",helperElementPadding:-4});"function"==typeof e&&a.onexit(e),"function"==typeof n&&a.oncomplete(n),a.start()},isSupportDeclarativeNetRequest:()=>{const{parsedResult:{browser:t}}=bowser.getParser(window.navigator.userAgent),e=t.name,n=parseFloat(t.version);return!!(["Chrome","Microsoft Edge"].includes(e)&&n>=84)||("Safari"===e&&n>=15||"Firefox"===e&&n>=113)},getRatingURL:(t="Chrome")=>{switch(t){case"Chrome":return"https://chrome.google.com/webstore/detail/llfhpkkeljlgnjgkholeppfnepmjppob/reviews";case"Safari":return"https://apps.apple.com/us/app/zadark-zalo-dark-mode/1615941471?action=write-review";case"Edge":return"https://microsoftedge.microsoft.com/addons/detail/nbcljbcabjegmmogkcegephdkhckegcf";case"Firefox":return"https://addons.mozilla.org/en-US/firefox/addon/zadark/reviews";default:return"#"}},initOSName:function(){const{parsedResult:{os:t}}=bowser.getParser(window.navigator.userAgent);this.setOSAttr(t.name)},initFontFamily:async function(){const{fontFamily:t}=await ZaDarkBrowser.getExtensionSettings(),e=!t,n=["Open Sans:400;500;600"];e||"Open Sans"===t||n.push(`${t}:400;500;600`),await this.installFontFamily(n,!1),e||this.setFontFamilyAttr(t)},initPageSettings:async function(){this.initOSName(),this.initFontFamily();const{theme:t,fontSize:e,enabledHideLatestMessage:n,enabledHideConvAvatar:a,enabledHideConvName:s,enabledHideThreadChatMessage:o,useHotkeys:r}=await ZaDarkBrowser.getExtensionSettings();this.setPageTheme(t),this.setFontSizeAttr(e),this.setHideLatestMessageAttr(n),this.setHideConvAvatarAttr(a),this.setHideConvNameAttr(s),this.setHideThreadChatMessageAttr(o),this.setUseHotkeysAttr(r)},installFontFamily:async(t=[],e=!0)=>{if(!t.length)return!1;try{return await ZaDarkFonts.loadGoogleFonts(t,e),!0}catch(t){return!1}},initTippy:()=>{tippy("[data-tippy-content]",{theme:"zadark",allowHTML:!0}),tippy("#div_Main_TabZaDark",{theme:"zadark",allowHTML:!0,content:`Cài đặt ZaDark ${ZaDarkBrowser.getManifest().version}`,placement:"right"}),tippy("#js-input-font-family",{theme:"zadark",allowHTML:!0,content:"<p>Nhập tên phông chữ từ <strong>Google Fonts</strong><br>(Lưu ý kí tự in hoa, khoảng cách).</p><p>Bỏ trống nếu dùng phông mặc định.</p><p>Nhấn <strong>Enter</strong> để áp dụng.</p>",trigger:"focus"}),tippy("#js-select-translate-target",{theme:"zadark",allowHTML:!0,content:"Bạn muốn dịch sang ngôn ngữ nào?"})},updateTheme:async function(t){await ZaDarkBrowser.saveExtensionSettings({theme:t}),this.setPageTheme(t)},updateFontFamily:async function(t){if(!t)return await ZaDarkBrowser.saveExtensionSettings({fontFamily:t}),this.setFontFamilyAttr(""),this.showToast("Đã thay đổi phông chữ"),!0;const e=this.showToast("Đang tải phông chữ...",{duration:-1}),n=await this.installFontFamily([`${t}:400;500;600`],!1);return e.hideToast(),n?(await ZaDarkBrowser.saveExtensionSettings({fontFamily:t}),this.setFontFamilyAttr(t),this.showToast("Đã thay đổi phông chữ"),!0):(this.showToast("Không thể tải phông chữ"),!1)},updateFontSize:async function(t){await ZaDarkBrowser.saveExtensionSettings({fontSize:t}),this.setFontSizeAttr(t),e.showToast(this.HOTKEYS_TOAST_MESSAGE.fontSize[t])},updateTranslateTarget:async function(t){return ZaDarkBrowser.saveExtensionSettings({translateTarget:t})},getThreadChatBgSettingKey:function(){const t=this.getCurrentConvId();return t?`threadChatBg_${t}`:null},updateThreadChatBg:async function(t){const e=this.getThreadChatBgSettingKey();if(!e)throw new Error("Bạn cần chọn một cuộc trò chuyện");t?await ZaDarkBrowser.saveExtensionSettingsLocal({[e]:t}):await ZaDarkBrowser.removeExtensionSettingsLocal([e]),this.refreshThreadChatBg(t),this.showToast(t?"Đã thay đổi hình nền":"Đã xóa hình nền")},updateHideLatestMessage:async function(t){await ZaDarkBrowser.saveExtensionSettings({enabledHideLatestMessage:t}),this.toggleBodyClassName("zadark-prv--latest-message",t),this.showToast(this.HOTKEYS_TOAST_MESSAGE.hideLatestMessage[t])},updateHideConvAvatar:async function(t){await ZaDarkBrowser.saveExtensionSettings({enabledHideConvAvatar:t}),this.toggleBodyClassName("zadark-prv--conv-avatar",t),this.showToast(this.HOTKEYS_TOAST_MESSAGE.hideConvAvatar[t])},updateHideConvName:async function(t){await ZaDarkBrowser.saveExtensionSettings({enabledHideConvName:t}),this.toggleBodyClassName("zadark-prv--conv-name",t),this.showToast(this.HOTKEYS_TOAST_MESSAGE.hideConvName[t])},updateHideThreadChatMessage:async function(t){await ZaDarkBrowser.saveExtensionSettings({enabledHideThreadChatMessage:t}),this.toggleBodyClassName("zadark-prv--thread-chat-message",t),this.showToast(this.HOTKEYS_TOAST_MESSAGE.hideThreadChatMessage[t])},updateUseHotkeys:async function(t){await ZaDarkBrowser.saveExtensionSettings({useHotkeys:t}),this.showToast(this.HOTKEYS_TOAST_MESSAGE.useHotkeys[t]),this.setUseHotkeysAttr(t)},showIntroHideThreadChatMessage:function({onExit:t,onComplete:e}={}){this.showIntro({steps:[{element:document.querySelector("#messageView"),intro:"Bạn di chuột vào vùng này để <strong>xem nội dung tin nhắn</strong>"},{element:document.querySelector("#chatInput"),intro:"Bạn di chuyển chuột vào vùng này để <strong>xem nội dung khung soạn tin nhắn</strong>"},{element:document.querySelector(".chat-box-bar"),intro:"Bạn di chuyển chuột vào vùng này để: <strong>Ẩn nội dung tin nhắn</strong> (bên trên), <strong>Ẩn nội dung khung soạn tin nhắn</strong> (bên dưới)"}],onExit:t,onComplete:e})},refreshThreadChatBg:(t="")=>{const n=e.getCurrentConvId(),a=e.getThreadChatBgSettingKey();let s=document.getElementById(a);if(!t){if(!s)return;s.remove();const t=s.getAttribute("data-blob-url");return void URL.revokeObjectURL(t)}const o=ZaDarkShared.convertBase64ToBlob(t),r=URL.createObjectURL(o),i=`body[data-current-conv-id="${n}"] { --zadark-thread-chat-bg-url: url('${r}'); }`;s?s.innerHTML=i:((s=document.createElement("style")).type="text/css",s.id=a,s.setAttribute("data-blob-url",r),s.appendChild(document.createTextNode(i)),document.head.appendChild(s))}};window.matchMedia("(prefers-color-scheme: dark)").addListener(function(t){ZaDarkBrowser.getExtensionSettings().then(({theme:n})=>{"auto"===n&&e.setThemeAttr(t.matches?"dark":"light")})}),t.ZaDarkUtils=e}(this);