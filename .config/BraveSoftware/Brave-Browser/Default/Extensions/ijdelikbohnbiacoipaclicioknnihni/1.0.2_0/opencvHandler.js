window.addEventListener("message",(function(e){"segmentBox"===e.data.type&&async function(e){var t,a,n="segmentSuccess",c=[],r=e.base64Url,o=1;try{var v=await(t=e.base64Url,new Promise(((e,a)=>{var n=new Image;n.onload=()=>{var t=document.createElement("canvas");t.width=n.naturalWidth,t.height=n.naturalHeight,t.getContext("2d").drawImage(n,0,0),e(t)},n.onerror=a,n.src=t}))),[i,o]=function(e){var t=document.createElement("canvas");let a=cv.imread(e),n=new cv.Mat;cv.cvtColor(a,a,cv.COLOR_RGBA2GRAY,0);var c=function(e,t,a){var n,c,r=e.cols,o=e.rows;c=t/r,n=[t,parseInt(o*c)];let v=new cv.Size(...n);return cv.resize(e,e,v,0,0,cv.INTER_AREA),c}(a,700);return cv.imshow(t,a),a.delete(),n.delete(),[t,c]}(v);c=function(e){document.createElement("canvas");let t=cv.imread(e),a=new cv.Mat;var n=[],c=t.cols,r=t.rows;let o=new cv.MatVector,v=new cv.Mat,i=new cv.Size(10,10);var s=cv.getStructuringElement(cv.MORPH_RECT,i);cv.cvtColor(t,a,cv.COLOR_RGBA2GRAY,0),cv.Sobel(a,a,cv.CV_8U,1,0,3,1,0,cv.BORDER_DEFAULT),cv.threshold(a,a,0,255,cv.THRESH_OTSU|cv.THRESH_BINARY),cv.morphologyEx(a,a,cv.MORPH_CLOSE,s),cv.findContours(a,o,v,cv.RETR_EXTERNAL,cv.CHAIN_APPROX_NONE);for(let e=0;e<o.size();++e){let t=o.get(e),a=cv.contourArea(t),v=Math.abs(cv.minAreaRect(t).angle),i=[0,90,180,270].some((e=>Math.abs(e-v)<=30));if(t.rows<100)continue;if(a<500||a>r/10*(c/10))continue;if(!i)continue;let s=cv.boundingRect(t);var l={left:Math.max(parseInt(s.x-10),0),top:Math.max(parseInt(s.y-10),0),width:Math.min(parseInt(s.width+20),c),height:Math.min(parseInt(s.height+20),r)};n.push(l)}return n}(i),r=i.toDataURL()}catch(e){console.log(e),n="segmentFail"}a={type:n,mainUrl:e.mainUrl,base64Url:r,lang:e.lang,bboxList:c,timeId:e.timeId,ratio:o},window.parent.postMessage(a,"*")}(e.data)}),!1);